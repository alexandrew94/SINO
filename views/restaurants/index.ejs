<% if (messages.successful) { %>
  <h3 class="successful message"><%= messages.successful %></h3>
<% } %>
<div class="container">
  <h1>Restaurants:</h1>
  <% if (locals.isLoggedIn) { %>
    <a href="/restaurants/new">Add a restaurant</a>
  <% } else { %>
    Please <a href="/signin">sign in</a> or <a href="/signup">sign up</a> to add a restaurant.
  <% } %>
  <% let postcodes = "http://maps.googleapis.com/maps/api/staticmap?zoom=12&size=400x400&"%>
  <% databaseEntries.forEach((entry) => { %>
    <% if (!!entry.postcode) { %>
      <% postcodes += "&markers=color:0xe57373%7C" + entry.postcode.split(' ').join(''); %>
    <% } %>
  <% }) %>
  <% postcodes += '"&key=AIzaSyDH5wP4WVr1VDXiOQroP-i4LFvc2aIp-RM'%>
  <% console.log('POSTCODES!', postcodes) %>
  <img src="<%- postcodes %>">
  <div class="row">
    <% databaseEntries.forEach((entry) => { %>
      <div class="col s6 m4">
        <div class="card sticky-action">
          <div class="card-image waves-effect waves-block waves-light">
            <% console.log('THE URL FOR THE IMAGE!', entry.image)%>
            <img class="activator" src="<%- entry.image %>">
          </div>
          <div class="card-content">
            <span class="card-title activator grey-text text-darken-4"><%- entry.name %><i class="material-icons right">more_vert</i></span>
            <% if (entry.user && locals.currentUser && entry.user.toString() === locals.currentUser.id) { %>
                <form action="/restaurants/<%= entry.id %>/edit" method="get">
                  <button>Edit</button>
                </form>
                <form action="/restaurants/<%= entry.id %>" method="post">
                  <input type="hidden" name="_method" value="delete">
                  <button>Delete</button>
                </form>
            <% } %>
          </div>
          <div class="card-reveal">
            <span class="card-title grey-text text-darken-4"><%- entry.name %><i class="material-icons right">close</i></span>
            <p><%- entry.description %></p>
          </div>
          <div class="card-action">
            <p><a href="/restaurants/<%= entry.id %>">View Restaurant</a></p>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>
